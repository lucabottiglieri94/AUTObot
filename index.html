<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI BOTT - Auto News</title>

  <style>
    :root{
      --bg:#0b0f1a; --panel:#111827; --line:#1f2937;
      --text:#e5e7eb; --muted:#9ca3af; --accent:#3b82f6;
      --danger:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);min-height:100vh}

    header{
      position:sticky; top:0; z-index:10;
      background:rgba(11,15,26,.9); backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}

    /* LOGO pi√π grande e leggibile */
    .logo{
      display:flex;align-items:baseline;gap:10px;
      font-size:34px; font-weight:900; letter-spacing:1px;
      line-height:1;
    }
    .logo .tag{
      font-size:12px; font-weight:700;
      color:var(--muted); border:1px solid var(--line);
      padding:4px 8px; border-radius:999px; letter-spacing:.8px;
    }

    .brands{display:flex;gap:10px;flex-wrap:wrap}
    .brand-btn{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      padding:8px 14px;border-radius:999px;
      color:var(--text); text-decoration:none;
      background:rgba(17,24,39,.6);
      transition:.15s;
    }
    .brand-btn:hover{border-color:#334155; transform:translateY(-1px)}
    main{max-width:1100px;margin:0 auto;padding:18px 16px 36px}
    .panel{
      border:1px solid var(--line);
      background:rgba(17,24,39,.55);
      border-radius:16px;
      padding:16px;
    }
    .panel-head{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .panel-title{display:flex;align-items:center;gap:10px;font-weight:800}
    .panel-title .icon{font-size:18px}
    .actions{display:flex;gap:10px;align-items:center}
    button{
      border:1px solid var(--line);
      background:rgba(17,24,39,.7);
      color:var(--text);
      padding:9px 12px;border-radius:10px;
      cursor:pointer;
    }
    button:hover{border-color:#334155}
    button:disabled{opacity:.55;cursor:not-allowed}

    .status{margin-top:10px;color:var(--muted);font-size:14px}

    .news-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 920px){ .news-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width: 640px){ .news-grid{grid-template-columns:1fr;} }

    .card{
      display:block;
      border:1px solid var(--line);
      background:rgba(15,23,42,.55);
      border-radius:14px;
      padding:12px;
      text-decoration:none;
      color:var(--text);
      min-height:120px;
      transition:.15s;
    }
    .card:hover{border-color:#334155; transform:translateY(-1px)}
    .card .t{font-weight:800;line-height:1.25;margin-bottom:6px}
    .card .m{color:var(--muted);font-size:13px;line-height:1.35}
    .meta{margin-top:10px;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}

    .err{
      margin-top:14px;
      border:1px solid rgba(239,68,68,.4);
      background:rgba(239,68,68,.08);
      color:#fecaca;
      border-radius:14px;
      padding:12px;
      display:flex;gap:10px;align-items:flex-start;
    }
    .err b{color:#fff}
    .err .x{color:var(--danger);font-weight:900}
    code.inline{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:8px;border:1px solid var(--line)}
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="logo">
          AI BOTT <span class="tag">AUTO NEWS</span>
        </div>

        <nav class="brands">
          <a class="brand-btn" href="https://www.fiat.it/omni/configuratore" target="_blank" rel="noopener">FIAT</a>
          <a class="brand-btn" href="https://www.jeep-official.it/" target="_blank" rel="noopener">JEEP</a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="panel-head">
        <div class="panel-title"><span class="icon">üì∞</span> Ultime News</div>
        <div class="actions">
          <button id="refreshBtn" type="button">Aggiorna</button>
        </div>
      </div>

      <div id="status" class="status">Stato: pronto</div>

      <div id="errorBox" class="err" style="display:none"></div>
      <div id="newsList" class="news-grid"></div>
    </section>
  </main>

  <script>
    // ‚úÖ METTI QUI IL TUO ENDPOINT GIUSTO (deve restituire JSON)
    const BACKEND_NEWS = "https://auto-backend-16xa61c8w-lucas-projects-93ba30e7.vercel.app/api/news";

    const $ = (id) => document.getElementById(id);

    function setStatus(msg){ $("status").textContent = "Stato: " + msg; }

    function showError(title, details){
      const box = $("errorBox");
      box.style.display = "flex";
      box.innerHTML = `
        <div class="x">‚úñ</div>
        <div>
          <b>${escapeHtml(title)}</b><div style="height:6px"></div>
          <div>${escapeHtml(details || "")}</div>
        </div>
      `;
    }
    function hideError(){
      $("errorBox").style.display = "none";
      $("errorBox").innerHTML = "";
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderItems(items){
      const list = $("newsList");
      list.innerHTML = "";

      if (!items || !items.length){
        list.innerHTML = `<div class="card" style="grid-column:1/-1">
          <div class="t">Nessuna news trovata</div>
          <div class="m">Controlla l'RSS nel backend o riprova pi√π tardi.</div>
        </div>`;
        return;
      }

      for (const n of items.slice(0, 6)){
        const a = document.createElement("a");
        a.className = "card";
        a.href = n.url || "#";
        a.target = "_blank";
        a.rel = "noopener";

        const title = n.title || "Senza titolo";
        const desc = (n.description || n.summary || "").trim();
        const source = n.source || n.site || "";
        const date = n.date || n.pubDate || "";

        a.innerHTML = `
          <div class="t">${escapeHtml(title)}</div>
          <div class="m">${escapeHtml(desc || "Apri per leggere.")}</div>
          <div class="meta">
            ${source ? `<span>${escapeHtml(source)}</span>` : ""}
            ${date ? `<span>${escapeHtml(date)}</span>` : ""}
          </div>
        `;

        list.appendChild(a);
      }
    }

    async function loadNews(){
      hideError();
      setStatus("caricamento news‚Ä¶");
      $("refreshBtn").disabled = true;

      try{
        const r = await fetch(BACKEND_NEWS, { method:"GET", cache:"no-store" });

        // ‚úÖ se 404/500 ecc: non provare a fare json()
        if (!r.ok){
          const txt = await r.text().catch(()=> "");
          const hint = txt.includes("<!DOCTYPE html>")
            ? "Il backend sta rispondendo con HTML (pagina errore), non JSON. URL /api/news sbagliato o deploy rotto."
            : "Risposta non valida dal backend.";
          throw new Error(`HTTP ${r.status}. ${hint}`);
        }

        // ‚úÖ controlla che sia JSON e non HTML ‚Äúmascherato‚Äù
        const ct = (r.headers.get("content-type") || "").toLowerCase();
        const raw = await r.text();

        if (raw.trim().startsWith("<!DOCTYPE html") || raw.trim().startsWith("<html")){
          throw new Error("Il backend ha restituito HTML invece di JSON. Controlla l'endpoint /api/news su Vercel.");
        }

        let data;
        try{
          data = JSON.parse(raw);
        }catch{
          throw new Error("JSON non valido dal backend. Controlla cosa ritorna /api/news.");
        }

        const items = data.items || data.news || [];
        renderItems(items);
        setStatus("ok");
      }catch(err){
        $("newsList").innerHTML = "";
        setStatus("errore caricamento news");
        showError("Errore caricamento news", String(err.message || err));
      }finally{
        $("refreshBtn").disabled = false;
      }
    }

    $("refreshBtn").addEventListener("click", loadNews);

    // avvio
    loadNews();
  </script>
</body>
</html>
